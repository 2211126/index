<!DOCTYPE html>
<html lang="ko" style="width:100vw;height:100vh;">
<head>
  <meta charset="UTF-8">
  <title>장욱진 미술관 네트워크 그래프 (인물 계층 구조)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    html, body {
      width: 100vw;
      height: 100vh;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #f6f6f6;
      font-family: 'Malgun Gothic', sans-serif;
    }
    svg {
      width: 100vw !important;
      height: 100vh !important;
      display: block;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    .legend {
      position: absolute;
      top: 20px;
      left: 20px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px 20px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      font-size: 14px;
      z-index: 10;
      max-height: 500px;
      overflow-y: auto;
    }
    .legend-item { display: flex; align-items: center; margin-bottom: 6px; }
    .legend-color { width: 18px; height: 18px; margin-right: 8px; border-radius: 50%; }
    .legend-square { width: 18px; height: 18px; margin-right: 8px; border-radius: 3px; }
    #search-box {
      position: absolute;
      top: 20px;
      right: 30px;
      z-index: 20;
    }
    #search {
      width: 200px;
      padding: 8px 12px;
      font-size: 15px;
      border: 1px solid #bbb;
      border-radius: 5px;
    }
    #tooltip {
      position: absolute;
      pointer-events: none;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px 15px;
      font-size: 13px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      display: none;
      z-index: 100;
      white-space: pre-line;
      color: #222;
      max-width: 320px;
    }
    .center-node {
      stroke: #333 !important;
      stroke-width: 4px !important;
    }
    .hub-node {
      stroke: #666 !important;
      stroke-width: 3px !important;
    }
    .sub-hub-node {
      stroke: #888 !important;
      stroke-width: 2px !important;
    }
    .leaf-node {
      stroke: #fff !important;
      stroke-width: 2px !important;
    }
    .highlighted {
      stroke: #ff0000 !important;
      stroke-width: 5px !important;
    }
    .highlighted-text {
      font-weight: bold !important;
      fill: #ff0000 !important;
    }
    .hub-text {
      font-weight: bold;
      font-size: 14px;
      fill: white;
      text-anchor: middle;
      dominant-baseline: middle;
      pointer-events: none;
    }
    .sub-hub-text {
      font-weight: bold;
      font-size: 12px;
      fill: white;
      text-anchor: middle;
      dominant-baseline: middle;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="legend">
    <div class="legend-item"><div class="legend-color" style="background:#ff4444"></div>중심(장욱진)</div>
    <div class="legend-item"><div class="legend-square" style="background:#ff7f7f"></div>1차 허브</div>
    <div class="legend-item"><div class="legend-square" style="background:#ffaaaa"></div>2차 허브 (인물 세분화)</div>
    <div class="legend-item"><div class="legend-color" style="background:#ff9999"></div>신사실파</div>
    <div class="legend-item"><div class="legend-color" style="background:#ff99cc"></div>지인</div>
    <div class="legend-item"><div class="legend-color" style="background:#bf7fff"></div>가족</div>
    <div class="legend-item"><div class="legend-color" style="background:#7fbf7f"></div>작품</div>
    <div class="legend-item"><div class="legend-color" style="background:#7f7fff"></div>전시</div>
    <div class="legend-item"><div class="legend-color" style="background:#ffbf7f"></div>장소</div>
  </div>
  <div id="search-box">
    <input id="search" type="text" placeholder="노드 이름 검색 (예: 장욱진, 김환기, 독)">
  </div>
  <div id="tooltip"></div>
  <svg id="network"></svg>
  <script>
    // 색상 매핑
    const color = d3.scaleOrdinal()
      .domain(["center", "hub", "sub-hub", "신사실파", "지인", "가족", "작품", "전시", "장소"])
      .range(["#ff4444", "#333", "#666", "#ff9999", "#ff99cc", "#bf7fff", "#7fbf7f", "#7f7fff", "#ffbf7f"]);

    // 허브별 색상 매핑
    const hubColors = {
      "인물허브": "#ff7f7f",
      "작품허브": "#7fbf7f", 
      "전시허브": "#7f7fff",
      "장소허브": "#ffbf7f",
      "신사실파허브": "#ff9999",
      "지인허브": "#ff99cc",
      "가족허브": "#bf7fff"
    };

    function getSize() {
      return {
        width: window.innerWidth,
        height: window.innerHeight
      };
    }

    // 데이터 구성 (새로운 계층 구조)
    const nodes = [
      // 중심 노드
      {id: "장욱진", group: "center", level: 0, type: "center", 
       출생: 1917, 사망: 1990, 태그: "신사실파, 동심의화가"},
      
      // 1차 허브 노드들
      {id: "인물허브", group: "hub", level: 1, type: "hub", 
       description: "장욱진과 관련된 인물들", displayText: "인물"},
      {id: "작품허브", group: "hub", level: 1, type: "hub", 
       description: "장욱진 대표작품들", displayText: "작품"},
      {id: "전시허브", group: "hub", level: 1, type: "hub", 
       description: "장욱진 관련 전시", displayText: "전시"},
      {id: "장소허브", group: "hub", level: 1, type: "hub", 
       description: "교육기관 및 미술관", displayText: "장소"},
      
      // 2차 허브 노드들 (인물 세분화)
      {id: "신사실파허브", group: "sub-hub", level: 2, type: "sub-hub", 
       description: "신사실파 동료 화가들", displayText: "신사실파"},
      {id: "지인허브", group: "sub-hub", level: 2, type: "sub-hub", 
       description: "장욱진의 지인들", displayText: "지인"},
      {id: "가족허브", group: "sub-hub", level: 2, type: "sub-hub", 
       description: "장욱진의 가족", displayText: "가족"},
      
      // 신사실파 노드들 (3차 레벨)
      {id: "김환기", group: "신사실파", level: 3, type: "leaf", 
       출생: 1913, 사망: 1974, 태그: "신사실파, 추상화가"},
      {id: "유영국", group: "신사실파", level: 3, type: "leaf", 
       출생: 1916, 사망: 2002, 태그: "신사실파, 기하학적 추상"},
      {id: "백영수", group: "신사실파", level: 3, type: "leaf", 
       출생: 1922, 사망: 2018, 태그: "신사실파, 서정적 추상"},
      {id: "이규상", group: "신사실파", level: 3, type: "leaf", 
       출생: 1918, 사망: 1964, 태그: "신사실파, 구상화가"},
      {id: "이중섭", group: "신사실파", level: 3, type: "leaf", 
       출생: 1916, 사망: 1956, 태그: "신사실파, 서정적 구상"},
      
      // 지인 노드들 (3차 레벨)
      {id: "마해송", group: "지인", level: 3, type: "leaf", 
       출생: 1905, 사망: 1966, 태그: "아동문학가, 동화작가"},
      {id: "오수환", group: "지인", level: 3, type: "leaf", 
       출생: 1946, 태그: "화가, 미술교육자"},
      {id: "최불암", group: "지인", level: 3, type: "leaf", 
       출생: 1940, 태그: "배우, 문화예술인"},
      {id: "이만익", group: "지인", level: 3, type: "leaf", 
       출생: 1938, 사망: 2012, 태그: "화가, 서양화가"},
      {id: "최종태", group: "지인", level: 3, type: "leaf", 
       출생: 1932, 태그: "조각가, 미술교육자"},
      {id: "경봉스님", group: "지인", level: 3, type: "leaf", 
       출생: 1892, 사망: 1982, 태그: "승려, 종교인"},
      
      // 가족 노드들 (3차 레벨)
      {id: "이순경", group: "가족", level: 3, type: "leaf", 
       출생: 1920, 사망: 2022, 태그: "배우자, 아내"},
      {id: "장정순", group: "가족", level: 3, type: "leaf", 
       출생: 1942, 태그: "첫째 딸"},
      {id: "장경수", group: "가족", level: 3, type: "leaf", 
       출생: 1945, 태그: "아들"},
      {id: "장희순", group: "가족", level: 3, type: "leaf", 
       출생: 1947, 태그: "둘째 딸"},
      {id: "장혜수", group: "가족", level: 3, type: "leaf", 
       출생: 1951, 태그: "셋째 딸"},
      
      // 작품 노드들 (2차 레벨)
      {id: "독", group: "작품", level: 2, type: "leaf", 
       제작연도: 1949, 기법: "캔버스에 유채", 크기: "45.1x37.7", 소장처: "국립현대미술관"},
      {id: "자화상", group: "작품", level: 2, type: "leaf", 
       제작연도: 1951, 기법: "캔버스에 유채", 크기: "14.8x10.8", 소장처: "개인 소장"},
      {id: "까치", group: "작품", level: 2, type: "leaf", 
       제작연도: 1958, 기법: "캔버스에 유채", 크기: "42x31", 소장처: "국립현대미술관"},
      {id: "월목", group: "작품", level: 2, type: "leaf", 
       제작연도: 1963, 기법: "캔버스에 유채", 크기: "53.3x38.4", 소장처: "미공개"},
      {id: "가족", group: "작품", level: 2, type: "leaf", 
       제작연도: 1973, 기법: "캔버스에 유채", 크기: "17.5x25", 소장처: "미공개"},
      {id: "나무와 새와 모자", group: "작품", level: 2, type: "leaf", 
       제작연도: 1973, 기법: "캔버스에 유채", 크기: "27.3x34.8", 소장처: "미공개"},
      {id: "가로수", group: "작품", level: 2, type: "leaf", 
       제작연도: 1978, 기법: "캔버스에 유채", 크기: "30x40", 소장처: "장욱진미술문화재단"},
      {id: "들", group: "작품", level: 2, type: "leaf", 
       제작연도: 1986, 기법: "캔버스에 유채", 크기: "45x22", 소장처: "미공개"},
      {id: "나무", group: "작품", level: 2, type: "leaf", 
       제작연도: 1986, 기법: "캔버스에 유채", 크기: "34.8x24.2", 소장처: "미공개"},
      {id: "나무와 나", group: "작품", level: 2, type: "leaf", 
       제작연도: 1988, 기법: "판화", 크기: "45.6x35.5", 소장처: "양주시립장욱진미술관"},
      {id: "진진묘", group: "작품", level: 2, type: "leaf", 
       제작연도: 1970, 기법: "캔버스에 유채", 크기: "41x32", 소장처: "미공개"},
      
      // 전시 노드들 (2차 레벨 - 이미지 데이터 완전 반영)
      {id: "장욱진의 삶과 예술세계", group: "전시", level: 2, type: "leaf", 
       코드: "AE01", 기간: "2017.05.26-2018.07.31", 장소: "양주시립장욱진미술관"},
      {id: "장욱진 백년, 인사동 라인에 서다", group: "전시", level: 2, type: "leaf", 
       코드: "AE02", 기간: "2017.07.24-2017.08.27", 장소: "서울 인사아트센터"},
      {id: "한국 근현대미술 걸작전", group: "전시", level: 2, type: "leaf", 
       코드: "AE03", 기간: "2019.09.27-2019.12.22", 장소: "여수 예울마루"},
      {id: "강가의 아틀리에", group: "전시", level: 2, type: "leaf", 
       코드: "AE04", 기간: "2020.10.27-2020.12.13", 장소: "양주시립장욱진미술관"},
      {id: "장욱진 30주기 기념전, 기가, 자연", group: "전시", level: 2, type: "leaf", 
       코드: "AE05", 기간: "2021.01.13-2021.02.28", 장소: "서울 현대화랑"},
      {id: "가장 진지한 고백: 장욱진 회고전", group: "전시", level: 2, type: "leaf", 
       코드: "AE06", 기간: "2023.09.14-2024.02.12", 장소: "국립현대미술관 덕수궁"},
      {id: "장욱진의 황금방주", group: "전시", level: 2, type: "leaf", 
       코드: "AE07", 기간: "2024.03.12-2024.07.28", 장소: "양주시립장욱진미술관"},
      
      // 장소 노드들 (2차 레벨 - 이미지 데이터 완전 반영)
      {id: "양정고등보통학교", group: "장소", level: 2, type: "leaf", 
       코드: "LC01", 목적: "교육", 위치: "대한민국", 건립: "1905년"},
      {id: "무사시노미술대학", group: "장소", level: 2, type: "leaf", 
       코드: "LC02", 목적: "교육", 위치: "일본", 건립: "1929년"},
      {id: "서울대학교", group: "장소", level: 2, type: "leaf", 
       코드: "LC03", 목적: "교육", 위치: "대한민국", 건립: "1946년"},
      {id: "홍도", group: "장소", level: 2, type: "leaf", 
       코드: "LC04", 목적: "종교", 위치: "대한민국", 건립: "643년"},
      {id: "국립현대미술관", group: "장소", level: 2, type: "leaf", 
       코드: "LC05", 목적: "미술전시", 위치: "대한민국", 건립: "1969년"},
      {id: "장욱진고택", group: "장소", level: 2, type: "leaf", 
       코드: "LC06", 목적: "수지기", 위치: "대한민국", 건립: "1884년"},
      {id: "장욱진미술문화재단", group: "장소", level: 2, type: "leaf", 
       코드: "LC07", 목적: "미술문화재단", 위치: "대한민국", 건립: "1997년"},
      {id: "양주시립장욱진미술관", group: "장소", level: 2, type: "leaf", 
       코드: "LC08", 목적: "미술전시", 위치: "대한민국", 건립: "2014년"},
      
      // 추가 장소들
      {id: "서울 인사아트센터", group: "장소", level: 2, type: "leaf", 
       목적: "미술전시", 위치: "서울시 종로구", 건립: "2000년대"},
      {id: "여수 예울마루", group: "장소", level: 2, type: "leaf", 
       목적: "미술전시", 위치: "전라남도 여수시", 건립: "2010년"},
      {id: "서울 현대화랑", group: "장소", level: 2, type: "leaf", 
       목적: "미술전시", 위치: "서울시 종로구", 건립: "1970년"},
      {id: "국립현대미술관 덕수궁", group: "장소", level: 2, type: "leaf", 
       목적: "미술전시", 위치: "서울시 중구", 건립: "1998년"}
    ];

    // 링크 구성 (새로운 계층 구조)
    const links = [
      // 중심 노드 → 1차 허브 노드들
      {source: "장욱진", target: "인물허브", type: "center-hub"},
      {source: "장욱진", target: "작품허브", type: "center-hub"},
      {source: "장욱진", target: "전시허브", type: "center-hub"},
      {source: "장욱진", target: "장소허브", type: "center-hub"},
      
      // 1차 허브 → 2차 허브 (인물 세분화)
      {source: "인물허브", target: "신사실파허브", type: "hub-sub"},
      {source: "인물허브", target: "지인허브", type: "hub-sub"},
      {source: "인물허브", target: "가족허브", type: "hub-sub"},
      
      // 2차 허브 → 3차 노드들 (신사실파)
      {source: "신사실파허브", target: "김환기", type: "sub-leaf"},
      {source: "신사실파허브", target: "유영국", type: "sub-leaf"},
      {source: "신사실파허브", target: "백영수", type: "sub-leaf"},
      {source: "신사실파허브", target: "이규상", type: "sub-leaf"},
      {source: "신사실파허브", target: "이중섭", type: "sub-leaf"},
      
      // 2차 허브 → 3차 노드들 (지인)
      {source: "지인허브", target: "마해송", type: "sub-leaf"},
      {source: "지인허브", target: "오수환", type: "sub-leaf"},
      {source: "지인허브", target: "최불암", type: "sub-leaf"},
      {source: "지인허브", target: "이만익", type: "sub-leaf"},
      {source: "지인허브", target: "최종태", type: "sub-leaf"},
      {source: "지인허브", target: "경봉스님", type: "sub-leaf"},
      
      // 2차 허브 → 3차 노드들 (가족)
      {source: "가족허브", target: "이순경", type: "sub-leaf"},
      {source: "가족허브", target: "장정순", type: "sub-leaf"},
      {source: "가족허브", target: "장경수", type: "sub-leaf"},
      {source: "가족허브", target: "장희순", type: "sub-leaf"},
      {source: "가족허브", target: "장혜수", type: "sub-leaf"},
      
      // 1차 허브 → 2차 노드들 (작품)
      {source: "작품허브", target: "독", type: "hub-leaf"},
      {source: "작품허브", target: "자화상", type: "hub-leaf"},
      {source: "작품허브", target: "까치", type: "hub-leaf"},
      {source: "작품허브", target: "월목", type: "hub-leaf"},
      {source: "작품허브", target: "가족", type: "hub-leaf"},
      {source: "작품허브", target: "나무와 새와 모자", type: "hub-leaf"},
      {source: "작품허브", target: "가로수", type: "hub-leaf"},
      {source: "작품허브", target: "들", type: "hub-leaf"},
      {source: "작품허브", target: "나무", type: "hub-leaf"},
      {source: "작품허브", target: "나무와 나", type: "hub-leaf"},
      {source: "작품허브", target: "진진묘", type: "hub-leaf"},
      
      // 1차 허브 → 2차 노드들 (전시)
      {source: "전시허브", target: "장욱진의 삶과 예술세계", type: "hub-leaf"},
      {source: "전시허브", target: "장욱진 백년, 인사동 라인에 서다", type: "hub-leaf"},
      {source: "전시허브", target: "한국 근현대미술 걸작전", type: "hub-leaf"},
      {source: "전시허브", target: "강가의 아틀리에", type: "hub-leaf"},
      {source: "전시허브", target: "장욱진 30주기 기념전, 기가, 자연", type: "hub-leaf"},
      {source: "전시허브", target: "가장 진지한 고백: 장욱진 회고전", type: "hub-leaf"},
      {source: "전시허브", target: "장욱진의 황금방주", type: "hub-leaf"},
      
      // 1차 허브 → 2차 노드들 (장소)
      {source: "장소허브", target: "양정고등보통학교", type: "hub-leaf"},
      {source: "장소허브", target: "무사시노미술대학", type: "hub-leaf"},
      {source: "장소허브", target: "서울대학교", type: "hub-leaf"},
      {source: "장소허브", target: "홍도", type: "hub-leaf"},
      {source: "장소허브", target: "국립현대미술관", type: "hub-leaf"},
      {source: "장소허브", target: "장욱진고택", type: "hub-leaf"},
      {source: "장소허브", target: "장욱진미술문화재단", type: "hub-leaf"},
      {source: "장소허브", target: "양주시립장욱진미술관", type: "hub-leaf"},
      {source: "장소허브", target: "서울 인사아트센터", type: "hub-leaf"},
      {source: "장소허브", target: "여수 예울마루", type: "hub-leaf"},
      {source: "장소허브", target: "서울 현대화랑", type: "hub-leaf"},
      {source: "장소허브", target: "국립현대미술관 덕수궁", type: "hub-leaf"},
      
      // 3차 요소간 직접 연결 (신사실파끼리)
      {source: "김환기", target: "유영국", type: "peer"},
      {source: "김환기", target: "백영수", type: "peer"},
      {source: "김환기", target: "이규상", type: "peer"},
      {source: "김환기", target: "이중섭", type: "peer"},
      {source: "유영국", target: "백영수", type: "peer"},
      {source: "유영국", target: "이규상", type: "peer"},
      {source: "유영국", target: "이중섭", type: "peer"},
      {source: "백영수", target: "이규상", type: "peer"},
      {source: "백영수", target: "이중섭", type: "peer"},
      {source: "이규상", target: "이중섭", type: "peer"},
      
      // 가족끼리 연결
      {source: "이순경", target: "장정순", type: "peer"},
      {source: "이순경", target: "장경수", type: "peer"},
      {source: "이순경", target: "장희순", type: "peer"},
      {source: "이순경", target: "장혜수", type: "peer"},
      {source: "장정순", target: "장경수", type: "peer"},
      {source: "장정순", target: "장희순", type: "peer"},
      {source: "장정순", target: "장혜수", type: "peer"},
      {source: "장경수", target: "장희순", type: "peer"},
      {source: "장경수", target: "장혜수", type: "peer"},
      {source: "장희순", target: "장혜수", type: "peer"},
      
      // 작품-소장처 연결
      {source: "독", target: "국립현대미술관", type: "peer"},
      {source: "까치", target: "국립현대미술관", type: "peer"},
      {source: "나무와 나", target: "양주시립장욱진미술관", type: "peer"},
      {source: "가로수", target: "장욱진미술문화재단", type: "peer"},
      
      // 전시-장소 연결
      {source: "장욱진의 삶과 예술세계", target: "양주시립장욱진미술관", type: "peer"},
      {source: "장욱진 백년, 인사동 라인에 서다", target: "서울 인사아트센터", type: "peer"},
      {source: "한국 근현대미술 걸작전", target: "여수 예울마루", type: "peer"},
      {source: "강가의 아틀리에", target: "양주시립장욱진미술관", type: "peer"},
      {source: "장욱진 30주기 기념전, 기가, 자연", target: "서울 현대화랑", type: "peer"},
      {source: "가장 진지한 고백: 장욱진 회고전", target: "국립현대미술관 덕수궁", type: "peer"},
      {source: "장욱진의 황금방주", target: "양주시립장욱진미술관", type: "peer"},
      
      // 가족과 거주지 연결
      {source: "이순경", target: "장욱진고택", type: "peer"},
      {source: "장혜수", target: "장욱진고택", type: "peer"},
      {source: "장경수", target: "장욱진미술문화재단", type: "peer"},
      {source: "장정순", target: "장욱진미술문화재단", type: "peer"},
      
      // 지인들 간의 교류 연결
      {source: "마해송", target: "오수환", type: "peer"},
      {source: "오수환", target: "이만익", type: "peer"},
      {source: "최불암", target: "경봉스님", type: "peer"}
    ];

    // SVG 및 시뮬레이션 설정
    let {width, height} = getSize();
    const svg = d3.select("#network")
      .attr("width", "100%")
      .attr("height", "100%")
      .attr("viewBox", `0 0 ${width} ${height}`);

    const container = svg.append("g");
    svg.call(d3.zoom()
      .scaleExtent([0.2, 4])
      .on("zoom", ({transform}) => container.attr("transform", transform))
    );

    const link = container.append("g")
      .attr("stroke", "#999")
      .attr("stroke-opacity", 0.6)
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("stroke-width", d => {
        if (d.type === "center-hub") return 4;
        if (d.type === "hub-sub") return 3;
        if (d.type === "sub-leaf") return 2;
        if (d.type === "hub-leaf") return 2;
        if (d.type === "peer") return 1.5;
        return 2;
      })
      .attr("stroke-dasharray", d => {
        if (d.type === "peer") return "5,5";
        return null;
      })
      .attr("stroke", "#999");

    const node = container.append("g")
      .selectAll("g")
      .data(nodes)
      .join("g")
      .attr("class", d => `node ${d.type}`);

    node.each(function(d) {
      const g = d3.select(this);
      
      if (d.type === "hub" || d.type === "sub-hub") {
        // 허브 노드는 사각형으로 생성
        const size = d.type === "hub" ? {width: 80, height: 40} : {width: 70, height: 35};
        g.append("rect")
          .attr("width", size.width)
          .attr("height", size.height)
          .attr("x", -size.width/2)
          .attr("y", -size.height/2)
          .attr("fill", hubColors[d.id] || "#333")
          .attr("stroke", "#666")
          .attr("stroke-width", d.type === "hub" ? 3 : 2)
          .attr("rx", 5)
          .attr("class", d.type + "-node");
        
        // 허브 텍스트
        g.append("text")
          .text(d.displayText)
          .attr("class", d.type === "hub" ? "hub-text" : "sub-hub-text")
          .attr("x", 0)
          .attr("y", 0);
          
      } else {
        // 일반 노드는 원형으로 생성
        g.append("circle")
          .attr("r", d => {
            if (d.type === "center") return 40;
            if (d.group === "신사실파") return 18;
            if (d.group === "지인") return 16;
            if (d.group === "가족") return 18;
            if (d.group === "작품") return 16;
            if (d.group === "전시") return 18;
            if (d.group === "장소") return 20;
            return 14;
          })
          .attr("fill", d => color(d.group))
          .attr("stroke", "#fff")
          .attr("stroke-width", 2)
          .attr("class", "leaf-node");
        
        // 일반 노드 텍스트
        g.append("text")
          .text(d => d.id.length > 8 ? d.id.slice(0,8) + "…" : d.id)
          .attr("font-size", d => d.type === "center" ? "14px" : "10px")
          .attr("text-anchor", "middle")
          .attr("dy", ".35em")
          .attr("pointer-events", "none")
          .attr("font-weight", d => d.type === "center" ? "bold" : "normal");
      }
    });

    // 툴팁
    const tooltip = d3.select("#tooltip");
    node.on("mouseover", (event, d) => {
      let html = `<b>${d.id}</b><br>`;
      if (d.type === "hub" || d.type === "sub-hub") {
        html += d.description ? `${d.description}<br>` : '';
      }
      if (d.코드) html += `코드: ${d.코드}<br>`;
      if (d.group === "신사실파" || d.group === "지인" || d.group === "가족" || d.group === "center") {
        html += d.출생 ? `출생: ${d.출생}` : '';
        html += d.사망 ? ` - 사망: ${d.사망}<br>` : '<br>';
        html += d.태그 ? `태그: ${d.태그}<br>` : '';
      }
      if (d.group === "작품") {
        html += d.제작연도 ? `연도: ${d.제작연도}<br>` : '';
        html += d.기법 ? `기법: ${d.기법}<br>` : '';
        html += d.크기 ? `크기: ${d.크기}<br>` : '';
        html += d.소장처 ? `소장처: ${d.소장처}<br>` : '';
      }
      if (d.group === "전시") {
        html += d.기간 ? `기간: ${d.기간}<br>` : '';
        html += d.장소 ? `장소: ${d.장소}<br>` : '';
      }
      if (d.group === "장소") {
        html += d.목적 ? `목적: ${d.목적}<br>` : '';
        html += d.위치 ? `위치: ${d.위치}<br>` : '';
        html += d.건립 ? `건립: ${d.건립}<br>` : '';
      }
      tooltip.html(html)
        .style("display", "block")
        .style("left", (event.pageX + 20) + "px")
        .style("top", (event.pageY - 10) + "px");
    }).on("mousemove", event => {
      tooltip.style("left", (event.pageX + 20) + "px")
        .style("top", (event.pageY - 10) + "px");
    }).on("mouseout", () => tooltip.style("display", "none"));

    // 드래그
    node.call(d3.drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended)
    );

    // 시뮬레이션 (계층 구조에 맞게 조정)
    let simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id).distance(d => {
        if (d.type === "center-hub") return 180;
        if (d.type === "hub-sub") return 120;
        if (d.type === "sub-leaf") return 100;
        if (d.type === "hub-leaf") return 120;
        if (d.type === "peer") return 60;
        return 100;
      }))
      .force("charge", d3.forceManyBody().strength(d => {
        if (d.type === "center") return -1000;
        if (d.type === "hub") return -800;
        if (d.type === "sub-hub") return -600;
        return -250;
      }))
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("radial", d3.forceRadial(d => {
        if (d.type === "center") return 0;
        if (d.type === "hub") return 180;
        if (d.type === "sub-hub") return 280;
        return 380;
      }, width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(d => {
        if (d.type === "center") return 50;
        if (d.type === "hub") return 50;
        if (d.type === "sub-hub") return 45;
        return 25;
      }));

    simulation.on("tick", () => {
      link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

      node
        .attr("transform", d => `translate(${d.x},${d.y})`);
    });

    function dragstarted(event, d) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x; d.fy = d.y;
    }
    function dragged(event, d) {
      d.fx = event.x; d.fy = event.y;
    }
    function dragended(event, d) {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null; d.fy = null;
    }

    // 검색 기능
    d3.select("#search").on("input", function() {
      const term = this.value.trim().toLowerCase();
      
      node.selectAll("circle, rect")
        .classed("highlighted", false)
        .attr("stroke", d => {
          if (d.type === "center") return "#333";
          if (d.type === "hub") return "#666";
          if (d.type === "sub-hub") return "#888";
          return "#fff";
        })
        .attr("stroke-width", d => {
          if (d.type === "center") return 4;
          if (d.type === "hub") return 3;
          if (d.type === "sub-hub") return 2;
          return 2;
        });
      
      node.selectAll("text")
        .classed("highlighted-text", false)
        .attr("font-weight", d => {
          if (d.type === "center") return "bold";
          if (d.type === "hub" || d.type === "sub-hub") return "bold";
          return "normal";
        })
        .attr("fill", d => (d.type === "hub" || d.type === "sub-hub") ? "white" : "#444");
      
      if (term) {
        const matchedNodes = nodes.filter(d => 
          d.id.toLowerCase().includes(term) || 
          (d.태그 && d.태그.toLowerCase().includes(term)) ||
          (d.소장처 && d.소장처.toLowerCase().includes(term)) ||
          (d.장소 && d.장소.toLowerCase().includes(term)) ||
          (d.displayText && d.displayText.toLowerCase().includes(term)) ||
          (d.코드 && d.코드.toLowerCase().includes(term))
        );
        
        matchedNodes.forEach(matchedNode => {
          node.filter(d => d.id === matchedNode.id)
            .selectAll("circle, rect")
            .classed("highlighted", true);
          
          node.filter(d => d.id === matchedNode.id)
            .selectAll("text")
            .classed("highlighted-text", true);
        });
      }
    });

    // 창 크기 변경 시 반응형 처리
    window.addEventListener("resize", () => {
      const size = getSize();
      svg.attr("viewBox", `0 0 ${size.width} ${size.height}`);
      
      simulation.force("center", d3.forceCenter(size.width / 2, size.height / 2));
      simulation.force("radial", d3.forceRadial(d => {
        if (d.type === "center") return 0;
        if (d.type === "hub") return 180;
        if (d.type === "sub-hub") return 280;
        return 380;
      }, size.width / 2, size.height / 2));
      simulation.alpha(0.5).restart();
    });
  </script>
</body>
</html>
